# YOLOv8 垃圾分类 mAP 性能分析报告

生成时间: 2025-11-13
分析对象: YOLOv8s 和 YOLOv8m 模型
数据集: Garbage Classification (6类)

---

## 📊 训练结果总览

### YOLOv8s (150 epochs)
- **mAP@0.5**: 0.5347 (53.47%)
- **mAP@0.5:0.95**: 0.3579 (35.79%)
- **Precision**: 0.5854
- **Recall**: 0.4848
- **F1-Score**: 0.5304

### YOLOv8m (150 epochs)
- **mAP@0.5**: 0.5246 (52.46%)
- **mAP@0.5:0.95**: 0.3549 (35.49%)
- **Precision**: 0.6025
- **Recall**: 0.4601
- **F1-Score**: 0.5217

---

## 🔍 主要问题诊断

### 1. ⚠️ **Recall 明显低于 Precision (漏检问题)**

**症状**:
- YOLOv8s: Precision (58.54%) > Recall (48.48%), 差距 10%
- YOLOv8m: Precision (60.25%) > Recall (46.01%), 差距 14%

**原因分析**:
- 模型过于保守，对不确定的目标不敢预测
- 置信度阈值 (conf_threshold) 可能设置过高
- 小目标检测能力不足
- Anchor boxes 可能不适配垃圾物体的尺寸分布

**影响**:
- 实际应用中会漏检很多垃圾物体
- 对于垃圾分类场景，漏检比误检更严重（宁可多检测也不要漏检）

---

### 2. ⚠️ **定位精度问题 (mAP 在高 IoU 下显著下降)**

**症状**:
- YOLOv8s: mAP@0.5 到 mAP@0.5:0.95 下降 33.1%
- YOLOv8m: mAP@0.5 到 mAP@0.5:0.95 下降 32.4%

**原因分析**:
- 边界框定位不够精确
- 训练图像分辨率可能不够 (当前 imgsz=640)
- Box loss weight 可能需要调整
- 数据标注质量可能存在问题

**影响**:
- 虽然能检测到目标，但边界框不够准确
- 在需要精确定位的场景下性能下降

---

### 3. ⚠️ **整体 mAP 偏低 (< 60%)**

**症状**:
- 两个模型的 mAP@0.5 都未达到 60%
- YOLOv8m 性能反而略低于 YOLOv8s

**原因分析**:
```
训练配置分析:
├── Epochs: 150 ✓ (但损失仍在下降，可继续训练)
├── Image Size: 640 ⚠️ (偏小，垃圾物体细节可能丢失)
├── Batch Size: 128/256 ✓ (足够大)
├── Optimizer: AdamW ✓
├── Learning Rate:
│   ├── lr0: 0.01 ✓
│   └── lrf: 0.001 ✓
├── Loss Weights:
│   ├── Box: 7.5 ✓
│   ├── Cls: 1.0 ⚠️ (分类损失占比41%，可能需要调整)
│   └── DFL: 1.5 ✓
├── Data Augmentation:
│   ├── Mosaic: 1.0 ✓
│   ├── Mixup: 0.15 ✓
│   ├── Copy-paste: 0.3 ✓
│   ├── HSV: h=0.03, s=0.9, v=0.6 ⚠️ (垃圾分类可能需要更强)
│   └── Geometric: degrees=15, scale=0.9 ✓
└── Freeze Layers: 0 ✓ (全部训练)
```

**可能的根本原因**:
1. **数据质量/数量问题**
   - 数据集规模是否足够（理想情况每类 500-1000 张）
   - 类别分布是否均衡
   - 标注质量是否准确
   - 数据多样性是否充足（不同光照、角度、背景）

2. **任务难度**
   - 垃圾分类中某些类别可能非常相似（如 PAPER vs CARDBOARD）
   - 背景复杂度高
   - 物体尺寸变化大

3. **模型容量**
   - YOLOv8s/m 可能不够大
   - 需要更深的网络来学习复杂特征

---

### 4. ✓ **训练过程健康指标**

**正面发现**:
- 过拟合控制良好: Train/Val loss 差距仅 0.03-0.08
- 损失持续下降: 最后50个epoch仍在改善
- 早期学习快速: 前30个epoch mAP提升明显
- 学习率调度合理: 从 0.082 衰减到 0.000077

---

## 💡 改进建议

### 🔴 **高优先级 (立即实施)**

#### 1. 增加训练轮数
```python
epochs: 150 → 250-300
patience: 50 → 100  # 增加早停耐心
```
**理由**: 损失仍在下降，模型未充分收敛

#### 2. 提高输入分辨率
```python
imgsz: 640 → 1280
```
**理由**:
- 提高定位精度，减少 mAP@0.5:0.95 下降
- 保留更多小目标细节
- 对垃圾分类这种需要精细特征的任务特别重要

#### 3. 调整置信度阈值（推理时）
```python
conf: 0.25 → 0.15-0.20  # 降低阈值减少漏检
```
**理由**: 提高 Recall，减少漏检

#### 4. 增加 Box Loss 权重
```python
box: 7.5 → 10.0-12.0
```
**理由**: 提高定位精度

---

### 🟡 **中优先级 (建议实施)**

#### 5. 使用更大的模型
```python
model_size: 'm' → 'l' 或 'x'
```
**理由**: YOLOv8m 性能未明显优于 YOLOv8s，可能需要更大容量

#### 6. 启用 Cosine Learning Rate
```python
cos_lr: False → True
```
**理由**: 更平滑的学习率衰减，可能获得更好的收敛

#### 7. 增强数据增强
```python
# 针对垃圾分类场景的特殊增强
hsv_h: 0.03 → 0.05     # 更强的色调变化
hsv_s: 0.9 → 1.0       # 最大饱和度变化
hsv_v: 0.6 → 0.8       # 更强的亮度变化
mixup: 0.15 → 0.2      # 增加混合概率
copy_paste: 0.3 → 0.4  # 增加复制粘贴

# 考虑添加:
blur: 0.1              # 添加模糊
noise: 0.1             # 添加噪声
```

#### 8. 调整分类损失权重
```python
cls: 1.0 → 1.5-2.0
```
**理由**: 分类损失占比41%，说明类别混淆严重

---

### 🟢 **低优先级 (可选尝试)**

#### 9. 尝试不同优化器
```python
optimizer: 'AdamW' → 'SGD'
lr0: 0.01 → 0.01-0.02  # SGD 可能需要更高学习率
momentum: 0.937        # SGD 专用
```

#### 10. 使用 Test-Time Augmentation
```python
# 推理时
model.val(augment=True)
```

#### 11. 多尺度训练
```python
multi_scale: False → True
```

#### 12. 类别加权损失
针对类别不平衡问题，需要分析各类别样本分布

---

## 🔬 需要进一步调查的问题

### 1. 数据集质量检查
- [ ] 统计各类别样本数量分布
- [ ] 可视化检查标注准确性
- [ ] 分析类别混淆矩阵
- [ ] 检查困难样本

### 2. 错误分析
- [ ] 查看验证集上的预测结果
- [ ] 找出漏检最严重的场景
- [ ] 分析定位不准的原因
- [ ] 识别最容易混淆的类别对

### 3. 模型分析
- [ ] 检查 feature map 激活情况
- [ ] 分析不同层的学习情况
- [ ] 尝试冻结不同的层数

---

## 📈 推荐的实验计划

### Experiment 1: 延长训练 + 更高分辨率
```python
{
    'model_size': 'm',
    'epochs': 300,
    'imgsz': 1280,
    'batch': 64,        # 分辨率翻倍，batch减半
    'box': 10.0,
    'cls': 1.5,
    'patience': 100,
    'cos_lr': True,
}
```
**预期提升**: +5-10% mAP

### Experiment 2: 更大模型 + 强增强
```python
{
    'model_size': 'l',
    'epochs': 250,
    'imgsz': 1280,
    'batch': 32,
    'hsv_h': 0.05,
    'hsv_s': 1.0,
    'hsv_v': 0.8,
    'mixup': 0.2,
    'copy_paste': 0.4,
}
```
**预期提升**: +8-15% mAP

### Experiment 3: 针对 Recall 优化
```python
{
    'model_size': 'm',
    'epochs': 250,
    'imgsz': 1280,
    'box': 10.0,
    'cls': 2.0,          # 增强分类
    'dfl': 2.0,          # 增强定位
    'conf': 0.15,        # 推理时降低阈值
}
```
**预期提升**: Recall +5-10%

---

## 📝 训练配置对比

| 配置项 | 当前值 | 推荐值 | 优先级 |
|--------|--------|--------|--------|
| epochs | 150 | 250-300 | 🔴 高 |
| imgsz | 640 | 1280 | 🔴 高 |
| model_size | s/m | l/x | 🟡 中 |
| box | 7.5 | 10-12 | 🔴 高 |
| cls | 1.0 | 1.5-2.0 | 🟡 中 |
| cos_lr | False | True | 🟡 中 |
| conf (推理) | 0.25 | 0.15-0.20 | 🔴 高 |
| hsv_h | 0.03 | 0.05 | 🟡 中 |
| hsv_s | 0.9 | 1.0 | 🟡 中 |
| hsv_v | 0.6 | 0.8 | 🟡 中 |

---

## 🎯 结论

当前模型的主要问题是：
1. **漏检严重**: Recall 显著低于 Precision
2. **定位不准**: 高 IoU 阈值下性能下降明显
3. **整体性能偏低**: mAP@0.5 未达到 60%

**核心改进方向**:
1. 延长训练（+100-150 epochs）
2. 提高分辨率（640 → 1280）
3. 优化 loss weights（box ↑, cls ↑）
4. 考虑使用更大模型（YOLOv8l/x）

**预期效果**:
实施高优先级改进后，预计 mAP@0.5 可提升至 **65-70%**，mAP@0.5:0.95 提升至 **45-50%**。

---

## 📚 相关可视化

生成的诊断图表:
- `loss_comparison.png` - 损失对比
- `metrics_comparison.png` - 指标对比
- `yolov8s_training_overview.png` - YOLOv8s 训练概览
- `yolov8m_training_overview.png` - YOLOv8m 训练概览
- `yolov8s_diagnostics.png` - YOLOv8s 深度诊断
- `yolov8m_diagnostics.png` - YOLOv8m 深度诊断

---

*报告生成工具: analyze_map_issues.py*
*如需更新分析，请重新运行该脚本*
